# ITER-20260219-04

## Objetivo y contexto
Habilitar consulta de Service Quotas desde CLI para `data-science-user`, especialmente cuotas de SageMaker Batch Transform, evitando bloqueos operativos por `ResourceLimitExceeded`.

## Decisiones tecnicas y alternativas descartadas
- Se agrego policy dedicada de solo lectura para Service Quotas (`08-ds-service-quotas-readonly.json`).
- Se mantiene least-privilege: solo acciones `List/Get` y alcance operacional en `eu-west-1`.
- Se actualizo `DataSciencePolicyAdministration` para permitir versionar/adjuntar la policy nueva sin romper flujo actual de bootstrap.
- Se descarto ampliar `01-ds-observability-readonly.json` para mantener separacion clara por dominio de permisos.

## IAM usado (roles/policies/permisos clave)
- Usuario operador: `data-science-user`.
- Policy nueva: `DataScienceServiceQuotasReadOnly`.
- Policy de administracion ajustada: `DataSciencePolicyAdministration`.

## Comandos ejecutados y resultado esperado
- `python3 -m json.tool docs/aws/policies/08-ds-service-quotas-readonly.json`
- `python3 -m json.tool docs/aws/policies/05-ds-policy-administration.json`
- `bash -n scripts/ensure_ds_policies.sh`
- `AWS_PROFILE=data-science-user scripts/ensure_ds_policies.sh --apply`
- `AWS_PROFILE=data-science-user AWS_REGION=eu-west-1 aws service-quotas list-service-quotas --service-code sagemaker --query "Quotas[?contains(QuotaName, 'for transform job usage')].[QuotaName,Value]" --output table`

Resultado esperado:
- Policy nueva creada/actualizada y adjunta a `data-science-user`.
- Consulta de quotas sin `AccessDenied`.

## Evidencia (outputs, logs, metricas)
- Se agrego `docs/aws/policies/08-ds-service-quotas-readonly.json`.
- Se actualizaron:
  - `docs/aws/policies/05-ds-policy-administration.json`
  - `scripts/ensure_ds_policies.sh`
  - `docs/aws/policies/README.md`
- `scripts/ensure_ds_policies.sh --apply`:
  - `Created policy DataScienceServiceQuotasReadOnly.`
  - `Attached policy DataScienceServiceQuotasReadOnly to data-science-user.`
- Prueba funcional Service Quotas:
  - comando `list-service-quotas` ejecutado sin `AccessDenied`.
  - salida actual: todas las cuotas `for transform job usage` reportan `0.0` en `eu-west-1` para esta cuenta.

## Riesgos/pendientes
- Si `aws:RequestedRegion` en la policy de quotas no aplica al endpoint de Service Quotas en algun flujo, se debera retirar/ajustar la condicion.
- Puede haber demoras normales en aprobacion de increase requests por Support aunque la consulta de quotas ya funcione.

## Proximo paso
Solicitar increase de al menos una cuota de transform job usage (por ejemplo `ml.m5.large`) o usar alternativa temporal sin Batch Transform (inferencia local) para poder cerrar fase 02.
