# ITER-20260219-03

## Objetivo y contexto
Habilitar a `data-science-user` para gestionar el ciclo de vida de training jobs de SageMaker desde terminal (`describe/stop/delete`) manteniendo principio least-privilege.

## Decisiones tecnicas y alternativas descartadas
- Se agrego una policy operativa dedicada (`07-ds-sagemaker-training-job-lifecycle.json`) en lugar de ampliar `01-ds-observability-readonly.json`.
- Scope acotado:
  - `ListTrainingJobs` y `DescribeTrainingJob` en `eu-west-1`.
  - `StopTrainingJob` y `DeleteTrainingJob` solo para `arn:aws:sagemaker:eu-west-1:939122281183:training-job/titanic-*`.
- Se actualizo `05-ds-policy-administration.json` para permitir adjuntar/versionar la nueva policy.
- Se descarto usar permisos amplios globales (`sagemaker:*` o `Resource: "*"`) para operaciones de escritura.

## IAM usado (roles/policies/permisos clave)
- Usuario operador: `data-science-user`.
- Policy nueva:
  - `DataScienceSageMakerTrainingJobLifecycle` (`docs/aws/policies/07-ds-sagemaker-training-job-lifecycle.json`).
- Policy bootstrap actualizada:
  - `DataSciencePolicyAdministration` (`docs/aws/policies/05-ds-policy-administration.json`).

## Comandos ejecutados y resultado esperado
- `python3 -m json.tool docs/aws/policies/05-ds-policy-administration.json`
- `python3 -m json.tool docs/aws/policies/07-ds-sagemaker-training-job-lifecycle.json`
- `AWS_PROFILE=data-science-user scripts/ensure_ds_policies.sh --check`
- Resultado esperado:
  - JSON validos.
  - `ensure --check` sin faltantes despues de aplicar policies en IAM.

## Evidencia (outputs, logs, metricas)
- Se agrego:
  - `docs/aws/policies/07-ds-sagemaker-training-job-lifecycle.json`
- Se actualizaron:
  - `docs/aws/policies/05-ds-policy-administration.json`
  - `scripts/ensure_ds_policies.sh`
  - `docs/aws/policies/README.md`

## Riesgos/pendientes
- Para aplicar la nueva policy en AWS, primero debe actualizarse la version default de `DataSciencePolicyAdministration` con el ARN nuevo.
- Si la policy nueva no queda adjunta al usuario, `sagemaker:DeleteTrainingJob` seguira retornando `AccessDenied`.

## Proximo paso
Aplicar la version nueva de `DataSciencePolicyAdministration`, ejecutar `scripts/ensure_ds_policies.sh --apply` y reintentar:
`aws sagemaker delete-training-job --training-job-name <job> --profile data-science-user --region eu-west-1`.
